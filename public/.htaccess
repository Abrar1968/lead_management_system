# =====================================================
# Laravel Production .htaccess (Hostinger Compatible)
# Location: /public/.htaccess
# =====================================================

# -----------------------------------------------------
# 1. Enable Rewrite Engine & Symlinks
# -----------------------------------------------------
<IfModule mod_rewrite.c>
    <IfModule mod_negotiation.c>
        Options -MultiViews -Indexes
    </IfModule>

    RewriteEngine On
    RewriteBase /

    # CRITICAL: Allow symlinks for storage link
    Options +FollowSymLinks

    # Handle Authorization Header (Sanctum / API / JWT)
    RewriteCond %{HTTP:Authorization} .
    RewriteRule .* - [E=HTTP_AUTHORIZATION:%{HTTP:Authorization}]

    # Handle X-XSRF-Token Header
    RewriteCond %{HTTP:x-xsrf-token} .
    RewriteRule .* - [E=HTTP_X_XSRF_TOKEN:%{HTTP:X-XSRF-Token}]

    # Remove trailing slash (if not a directory)
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} (.+)/$
    RewriteRule ^ %1 [L,R=301]

    # Front Controller (Laravel routes)
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^ index.php [L]
</IfModule>

# -----------------------------------------------------
# 2. File Access Permissions
# -----------------------------------------------------
<FilesMatch ".*">
    Require all granted
</FilesMatch>

# -----------------------------------------------------
# 3. Default Charset
# -----------------------------------------------------
AddDefaultCharset utf-8

# -----------------------------------------------------
# 4. Security Headers
# -----------------------------------------------------
<IfModule mod_headers.c>
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# -----------------------------------------------------
# 5. MIME Types for all supported file formats
# -----------------------------------------------------
<IfModule mod_mime.c>
    # Image types (4 formats)
    AddType image/jpeg .jpg .jpeg
    AddType image/png .png
    AddType image/gif .gif
    AddType image/webp .webp

    # Document types (6 formats)
    AddType application/pdf .pdf
    AddType application/msword .doc
    AddType application/vnd.openxmlformats-officedocument.wordprocessingml.document .docx
    AddType application/vnd.ms-excel .xls
    AddType application/vnd.openxmlformats-officedocument.spreadsheetml.sheet .xlsx
    AddType text/plain .txt
</IfModule>

# -----------------------------------------------------
# 6. Cache Static Assets
# -----------------------------------------------------
<IfModule mod_expires.c>
    ExpiresActive On

    ExpiresByType image/jpg  "access plus 1 year"
    ExpiresByType image/jpeg "access plus 1 year"
    ExpiresByType image/png  "access plus 1 year"
    ExpiresByType image/webp "access plus 1 year"
    ExpiresByType image/gif  "access plus 1 year"

    ExpiresByType text/css "access plus 1 month"
    ExpiresByType application/javascript "access plus 1 month"
    ExpiresByType text/javascript "access plus 1 month"

    ExpiresByType application/pdf "access plus 1 month"
</IfModule>

# -----------------------------------------------------
# 7. Compression (GZIP)
# -----------------------------------------------------
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain text/html text/xml text/css
    AddOutputFilterByType DEFLATE application/javascript application/json
    AddOutputFilterByType DEFLATE application/xml+rss application/atom+xml
</IfModule>
